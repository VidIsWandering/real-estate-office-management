name: Generate PlantUML Diagrams

on:
  push:
    branches:
      - main
      - master
    paths:
      - 'docs/diagrams/src/**.plantuml'

# Cấp quyền cho Action
permissions:
  contents: write
  pull-requests: write

jobs:
  generate-diagrams:
    runs-on: ubuntu-latest
    
    steps:
      # Bước 1: Checkout code
      - name: Checkout repository
        uses: actions/checkout@v4

      # Bước 2: Chạy action (SỬA LỖI: dùng @v1)
      - name: Generate diagram
        uses: cloudbees/plantuml-github-action@v1
        with:
          source: 'docs/diagrams/src/use_case_diagram.plantuml'
          output: 'docs/diagrams/generated/use_case_diagram.png'

      # Bước 3: Tự động commit file ảnh .png vừa tạo
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ci(docs): Auto-generate diagrams"
          file_pattern: 'docs/diagrams/generated/*.png'